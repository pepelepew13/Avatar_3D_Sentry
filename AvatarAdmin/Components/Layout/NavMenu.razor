@implements IDisposable
@inject NavigationManager Nav
@inject AvatarAdmin.Services.AuthState Auth

<nav class="sentry-nav" aria-label="Menú">
  <div class="sentry-nav-section">
    <NavLink class="sentry-nav-link" href="" Match="NavLinkMatch.All">
      <span class="material-symbols-outlined" aria-hidden="true">dashboard</span>
      Panel Principal
    </NavLink>
  </div>

  @if (Auth.IsAdmin)
  {
    <div class="sentry-nav-group">
      <p class="sentry-nav-group-title">Administración</p>
      <NavLink class="sentry-nav-link" href="/users">
        <span class="material-symbols-outlined" aria-hidden="true">people</span>
        Usuarios
      </NavLink>
      <NavLink class="sentry-nav-link" href="/companies">
        <span class="material-symbols-outlined" aria-hidden="true">business</span>
        Compañías
      </NavLink>
      <NavLink class="sentry-nav-link" href="/sites">
        <span class="material-symbols-outlined" aria-hidden="true">store</span>
        Sucursales
      </NavLink>
    </div>
  }

  <div class="sentry-nav-group">
    <p class="sentry-nav-group-title">Configuración 3D</p>
    <NavLink class=@($"sentry-nav-link {(Auth.IsAuthenticated ? "" : "is-disabled")}") href="/editor">
      <span class="material-symbols-outlined" aria-hidden="true">face</span>
      Editor de Avatar
    </NavLink>
    <NavLink class=@($"sentry-nav-link {(Auth.IsAuthenticated ? "" : "is-disabled")}") href="/gallery">
      <span class="material-symbols-outlined" aria-hidden="true">photo_library</span>
      Galería por Sede
    </NavLink>
    <NavLink class=@($"sentry-nav-link {(Auth.IsAuthenticated ? "" : "is-disabled")}") href="/profile/avatar">
      <span class="material-symbols-outlined" aria-hidden="true">person</span>
      Perfil de Avatar
    </NavLink>
    @if (Auth.IsAdmin)
    {
      <NavLink class="sentry-nav-link" href="/configs">
        <span class="material-symbols-outlined" aria-hidden="true">palette</span>
        Config. Avatares
      </NavLink>
    }
  </div>

  <div class="sentry-nav-section sentry-nav-actions">
    @if (Auth.IsAuthenticated)
    {
      <button type="button" class="sentry-nav-link sentry-nav-btn" @onclick="Logout">
        <span class="material-symbols-outlined" aria-hidden="true">logout</span>
        Cerrar sesión
      </button>
    }
    else
    {
      <NavLink class="sentry-nav-link" href="/auth">
        <span class="material-symbols-outlined" aria-hidden="true">login</span>
        Iniciar sesión
      </NavLink>
    }
  </div>
</nav>

@code {
  protected override void OnInitialized()
  {
    Auth.Changed += OnAuthChanged;
  }

  private void OnAuthChanged() => InvokeAsync(StateHasChanged);

  private void Logout()
  {
    Auth.Logout();
    Nav.NavigateTo("/auth", forceLoad: true);
  }

  public void Dispose() => Auth.Changed -= OnAuthChanged;
}
